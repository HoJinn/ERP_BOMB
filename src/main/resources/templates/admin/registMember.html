<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5" lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="shortcut icon" th:href="@{/uses/Logo.png}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans&family=Noto+Sans+KR:wght@100&display=swap">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" />
<link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.9/css/select2.min.css" rel="stylesheet" />
<link th:href="@{/uses/vendor/fontawesome-free/css/all.min.css}" rel="stylesheet" type="text/css">
<link th:href="@{/uses/css/sb-admin-2.min.css}" rel="stylesheet">
<link th:href="@{/uses/vendor/datatables/dataTables.bootstrap4.min.css}" rel="stylesheet">
<link rel="stylesheet" th:href="@{/css/common/header.css}">
<link rel="stylesheet" th:href="@{/css/inventory/inventory.css}">
<link rel="stylesheet" th:href="@{/css/admin/signup.css}">
<!-- 여기에 페이지 css파일 적용 -->
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css"><!-- dataTable -->
<title>ERP BOMB</title>
</head>
<body>

	<!-- header -->
	<header id="top">
		<th:block th:include="common/header" />
	</header>

	<section>
		<nav class="navbar navbar-expand-sm navbar-light bg-light">
			<a class="navbar-brand font-weight-bold" href="/"> <img
				th:src="@{/uses/logo_new.png}" alt="" class="logo">
			</a>
			<div class="collapse navbar-collapse function-tab">
				<ul class="navbar-nav mr-3 top-tap">
				   <li class="nav-item mr-3">
	                  <a class="nav-link font-weight-bold" href="/main/main">메인 페이지</a>
	               </li>
	               <li class="nav-item mr-3">
	                  <a class="nav-link font-weight-bold" href="/board/boardList">게시판</a>
	               </li>
	               <li class="nav-item mr-3">
	                  <a class="nav-link font-weight-bold" href="/ea/ea">전자결재</a>
	               </li>
	               <li class="nav-item mr-3">
	                  <a class="nav-link font-weight-bold" href="/salary/salary">급여관리</a>
	               </li>
	               <li class="nav-item mr-3">
	                  <a class="nav-link font-weight-bold" href="/sp/sp">퇴직금</a>
	               </li>
	               <li class="nav-item mr-3">
	                  <a class="nav-link font-weight-bold" href="/inventory/inventory">재고 관리</a>
	               </li>
	               <li class="nav-item mr-3">
	                  <a class="nav-link font-weight-bold" href="/tna/tna">근태 관리</a>
	               </li>
	               <li class="nav-item mr-3">
	                  <a class="nav-link font-weight-bold" href="/inOut/inOut">입출고</a>
	               </li>
				</ul>
			</div>
		</nav>
		<hr class="m-0">
		<div id="wrapper">

			<!-- Sidebar -->
			<ul
				class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion"
				id="accordionSidebar">

				<!-- Sidebar - Brand -->
				<a class="sidebar-brand" href="inventory/inventory">
					<div class="sidebar-brand-icon rotate-n-15"></div>
					<div class="sidebar-brand-text mx-3">관리자 페이지</div>
				</a>

				<!-- Divider -->
				<hr class="sidebar-divider my-0">

				<!-- Divider -->
				<hr class="sidebar-divider">

				<!-- Nav Item - Pages Collapse Menu -->
				<li class="nav-item">
					<a class="nav-link " href="/admin/authority">
						<span>권한 관리</span>
					</a>
					<a class="nav-link mt-1 on" href="/admin/member">
						<span>회원 관리</span>
					</a>
					<a class="nav-link mt-1" href="/admin/company">
						<span>회사 관리</span>
					</a>
					<a class="nav-link mt-1" href="/admin/rank">
						<span>직급 관리</span>
					</a>
					<a class="nav-link mt-1" href="/admin/dept">
						<span>부서 관리</span>
					</a>
					<a class="nav-link mt-1" href="/admin/icecream">
						<span>아이스크림 관리</span>
					</a>
					<a class="nav-link mt-1" href="/admin/sp">
						<span>퇴직금 관리</span>
					</a>
					<a class="nav-link mt-1" href="/admin/document">
						<span>문서 관리</span>
					</a>
				</li>


				<hr class="sidebar-divider">
			</ul>
			<!-- End of Sidebar -->
			
      <div class="section-main-div">
        <br>
        <h2 class="signup-text">회원 추가</h2>
        <br>
        <form class="signup-form" id="signup-form" action="/admin/signup" method="POST">
        	<div class="row pb-0">
		          <input required type="text" name="name" id="name" class="form-control col-8" placeholder="사용하실 이름를 입력해주세요." autofocus>
		          <div class="col-1"></div>
		          <button type="button" id="name-check-btn" class="double-check-btn col-3 hsy-btn btn btn-lg btn-block btn-outline-dark">중복확인</button>
		          <label class="name-result mb-0" id="name-result"></label>
          	</div>
          	<br>
          	<div class="row">
	          <select class="form-control" id="companyCode" name="companyCode" required="required">
	          		<!-- 회사 코드 ajax로 처리 -->
	          </select>
	        </div>
	        <br>
	        <div class="row">
	          <select class="form-control" id="deptCode" name="deptCode" required="required">
	          		<!-- 부서 코드 ajax로 처리 -->
	          </select>
	        </div>
	        <br>
	        <div class="row">
	          <select class="form-control" id="rankCode" name="rankCode" required="required">
	          		<!-- 직급 코드 ajax로 처리 -->
	          </select>
	        </div>
	        <br>
          	<div class="row">
		          <input required type="password" name="pwd" id="password" class="form-control" placeholder="영문 대 소문+숫자+특수문자 8~16자리">
		          <label class="password-result mb-0" id="password-result"></label>
		    </div>
          	<br>
	        <div class="row">
	          <input required type="password" name="password-check" id="password-check" class="form-control" placeholder="패스워드를 다시 입력해주세요.">
	          <label class="password-result mb-0" id="password-check-result"></label>
	        </div>
          	<br>
            <div class="row">
	          <input required type="text" name="empNo" id="empNo" class="form-control" placeholder="사번을 입력해주세요    예)201">
	          <label class="empNo-result mb-0" id="empNo-result"></label>
	        </div>
	        <br>
	        <div class="row">
	          <input required type="text" name="birth" id="birth" class="form-control" placeholder="생년월일을 입력해주세요    예)19990719">
	          <label class="birth-result mb-0" id="birth-result"></label>
	        </div>
	        <br>
	        <div class="row">
	          <input required type="text" name="phone" id="phone" class="form-control" placeholder="휴대폰 번호 '-'표 없이 입력해 주세요.">
	          <label class="phone-result mb-0" id="phone-result"></label>
	        </div>
	        <br>
	        <div class="row">
	          <input required type="text" name="regularPay" id="regularPay" class="form-control" placeholder="기본급을 입력하세요		예)3500000">
	          <label class="regularPay-result mb-0" id="regularPay-result"></label>
	        </div>
	        <br>
	        <div class="row">
	          <input required type="text" name="annualIncome" id="annualIncome" class="form-control" placeholder="연봉을 입력하세요		예)55000000">
	          <label class="annualIncome-result mb-0" id="annualIncome-result"></label>
	        </div>
	        <br>
	        <div class="row">
                <input type="text" name="email" id="email" class="form-control" placeholder="이메일을 입력해주세요		예)grape420@naver.com" autofocus required>
                <label class="email-result mb-0" id="email-result"></label>
            </div>
            <br>
	          <div class="row">
	          <button id="submit-btn" type="button" class="col-12 hsy-btn btn btn-lg btn-block btn-outline-dark" value="로그인">회원가입</button>
	          </div>
        </form>
      </div>

		</div>
	</section>
	
	<script>
 		$.ajax({
			url: "/admin/companyCode",
			success: function(data){
				const $companyCode = $("#companyCode");
				$companyCode.html("");
				
				for (let i in data){
					$companyCode.append($("<option>").val(data[i].serialNo).text(data[i].name));
				}
			},
			error: function(xhr){
				console.log(xhr);
			}
		});
		
		$.ajax({
			url: "/admin/deptCode",
			success: function(data){
				const $deptCode = $("#deptCode");
				$deptCode.html("");
				
				for (let i in data){
					$deptCode.append($("<option>").val(data[i].no).text(data[i].name));
				}
			},
			error: function(xhr){
				console.log(xhr);
			}
		}); 
		
		$.ajax({
			url: "/admin/rankCode",
			success: function(data){
				const $rankCode = $("#rankCode");
				$rankCode.html("");
				
				for (let i in data){
					$rankCode.append($("<option>").val(data[i].no).text(data[i].name));
				}
			},
			error: function(xhr){
				console.log(xhr);
			}
		}); 
		
		var code = "";
		var nameFlag = false;
		var passwordFlag = false;
		var birthFlag = false;
		var phoneFlag = false;
		var empNoFlag = false;
		var emailFlag = false;
		var regularPayFlag = false;
		var annualIncomeFlag = false;
		
			$("#name-check-btn").click(function() {
				var nameExp = /^[가-힣0-9a-zA-Z]{2,}$/;
				const value = $("#name").val();
				
				if (!nameExp.test($("#name").val())) {
					$("#name-result").text("이름을 다시 입력하세요").css("color", "red");
					$("#name").val("").focus();
				} else {
					$.ajax({
						url: "/admin/nameCheck",
						type: "GET",
						data: {
							value : value
							},
						success: function(data) {
							if(data) {
								$("#name-result").text("중복된 이름 입니다.").css("color", "red");
								$("#name").val("").focus();
							} else {
								console.log("여기는 else : " + data);
								$("#name-result").text("사용 가능한 이름 입니다.").css("color", "blue");
								nameFlag = true;
							}
						},
						error: function(request, status, error) {
							alert("code:" + request.responseText + "\n"
								+ "message:" + request.responseText + "\n"
								+ "error:" + error);
						}
					});
				}	
			});
			
			$("#submit-btn").click(function() {
				if(phoneFlag == false) {
					$("#phone-result").text("휴대폰 번호를 다시 확인 해주세요").css("color", "red");
					$("#phone").val("").focus();
				}
				
				if(regularPayFlag == false) {
					$("#regularPay-result").text("기본급을 다시 확인 해주세요").css("color", "red");
					$("#regularPay").val("").focus();
				}
				
				if(annualIncomeFlag == false) {
					$("#annualIncome-result").text("연봉을 다시 확인 해주세요").css("color", "red");
					$("#annualIncome").val("").focus();
				}
				
				if(empNoFlag == false) {
					$("#empNo-result").text("사번를 다시 확인 해주세요").css("color", "red");
					$("#empNo").val("").focus();
				}
				
				if(birthFlag == false) {
					$("#birth-result").text("생년월일을 확인 해주세요.").css("color", "red");
					$("#birth").val("").focus();
				}
				
				if(passwordFlag == false) {
					$("#password-result").text("비밀번호를 다시 확인 해주세요.").css("color", "red");
					$("#passowrd").val("").focus();
				}
				
				if(nameFlag == false) {
					$("#name-result").text("이름 중복 확인을 해주세요.").css("color", "red");
					$("#name").val("").focus();
				}
				
				if(emailFlag == false) {
					$("#email-result").text("이메일을 다시 확인해주세요.").css("color", "red");
					$("#email").val("").focus();
				}
				
				if((nameFlag == true) && (passwordFlag == true) && (birthFlag == true) && (phoneFlag == true) &&
				   (emailFlag == true) && (empNoFlag == true) && (regularPayFlag == true) && (annualIncomeFlag == true)) {
					alert("회원 추가가 성공적으로 완료되었습니다");
					 $("#signup-form").submit(); 
				}
			});
	</script>
	
	<!-- dataTable -->
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>
	
	<!-- signup -->
	<script type="text/javascript" th:src="@{/js/admin/signup.js}"></script>
</body>
</html>